{% extends "base.html" %}

{% block title %}{{ thread.title }}{% endblock %}

{% load humanize %} {% block content %}

<h1 class="page-heading">{{ thread.title }}</h1>

<div class="card">
    <div class="card-header">
        {{ thread.title }}
        {% if thread.locked %}
            <span class="badge" style="background-color:#fdecea;color:#d93025;border-color:#f5c6cb;">
                ƒê√É KH√ìA
            </span>
        {% endif %}
    </div>

    <div class="card-line">
        <strong>{{ thread.author.username }}</strong>
        ‚Ä¢ {{ thread.created_at|date:"H:i d/m/Y" }}
        ‚Ä¢ Chuy√™n m·ª•c: {{ thread.category.title }}
    </div>

    {% if request.user.is_staff_role %}
    <div class="staff-actions" style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed #eee;">
        <h4 style="font-size: 14px; margin: 0 0 10px 0;">H√†nh ƒë·ªông Qu·∫£n tr·ªã:</h4>
        <form action="{% url 'forum:thread_toggle_lock' thread.id %}" method="post" style="display: inline;">
            {% csrf_token %}
            {% if thread.locked %}
                <button type="submit" class="btn-primary" style="background-color: #28a745; width: auto; border: none;">
                    üîì M·ªü kh√≥a ch·ªß ƒë·ªÅ n√†y
                </button>
            {% else %}
                <button type="submit" class="btn-danger" style="width: auto;">
                    üîí Kh√≥a ch·ªß ƒë·ªÅ n√†y
                </button>
            {% endif %}
        </form>
    </div>
    {% endif %}
</div>
<div class="card" style="padding: 0;"> <div class="card-header" style="border-bottom: 1px solid var(--color-border);">
        C√°c tr·∫£ l·ªùi
    </div>

    <div class="post-list-container">
        {% for p in page_obj %}
        <div class="post-layout">
            
            <div class="post-user-info">
                <a href="{% url 'accounts:profile_view' p.author.pk %}">
                    <img src="{{ p.author.avatar.url }}" alt="avatar">
                    
                    <strong>{{ p.author.get_display_name }}</strong>
                </a>
            </div>
            
            <div class="post-content-wrap">
                <div class="post-header">
                    <span class="post-time">{{ p.created_at|naturaltime }}</span>
                    
                    {% if request.user == p.author %}
                    <span class="post-actions">
                        <a href="{% url 'forum:post_edit' p.id %}?page={{ page_obj.number }}" style="color: #007bff;display: grid;">S·ª≠a</a>
                        
                        <form action="{% url 'forum:post_delete' p.id %}" method="post" style="display: inline;" 
                              onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i n√†y?');">
                            {% csrf_token %}
                            <button type="submit" style="color: #dc3545; background: none; border: none; cursor: pointer; padding: 0; margin-left: 5px;">X√≥a</button>
                        </form>
                    </span>
                    {% endif %}
                </div>
                
                <div class="post-body">
                    {{ p.content }}
                </div>
                
                
            </div>
            
        </div>
        {% empty %}
            <div style="padding: 1.25rem;">Ch∆∞a c√≥ tr·∫£ l·ªùi n√†o</div>
        {% endfor %}
    </div>

    <div class="pagination" style="margin-top: 20px; text-align: center; padding-bottom: 1.25rem;">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; Trang ƒë·∫ßu</a>
            <a href="?page={{ page_obj.previous_page_number }}">Trang tr∆∞·ªõc</a>
        {% endif %}
        
        <span class="current">
            Trang {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}.
        </span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">Trang sau</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">Trang cu·ªëi &raquo;</a>
        {% endif %}
    </div>
</div>
<div class="card form-wrapper" style="max-width:100%;">
    <div class="card-header">G·ª≠i tr·∫£ l·ªùi</div>

    {% if not request.user.is_authenticated %}
        <div class="alert-info">
            B·∫°n c·∫ßn
            <a href="{% url 'accounts:login' %}" style="color:var(--color-accent);text-decoration:none;">
                ƒëƒÉng nh·∫≠p
            </a>
            ƒë·ªÉ tr·∫£ l·ªùi.
        </div>
    {% else %}
        {% if thread.locked %}
            <div class="alert-error">
                Ch·ªß ƒë·ªÅ n√†y ƒë√£ b·ªã kh√≥a
            </div>
        {% else %}
            <form method="post">
                {% csrf_token %}
                <div class="form-group">
                    <label class="form-label">N·ªôi dung tr·∫£ l·ªùi</label>
                    {{ form.content }} {% if form.content.errors %}
                        <div class="form-error">{{ form.content.errors }}</div>
                    {% endif %}
                </div>
                <button type="submit" class="btn-primary">Tr·∫£ l·ªùi</button>
            </form>
        {% endif %}
    {% endif %}
</div>
{% endblock %}